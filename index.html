<html>

<head>
  <title>Flexagonator</title>
  <script src="build/out.js"></script>
  <script type="text/javascript">
    var flexagon = Flexagonator.makeFlexagon(Flexagonator.hexaHexaLeafTree);
    var fm = Flexagonator.makeFlexagonManager(flexagon, Flexagonator.hexaHexaProperties);
    var stripContent = 0/*StripContent.FoldingLabels*/;

    function updateUI() {
      Flexagonator.drawEntireFlexagon('interface', fm);
      Flexagonator.drawUnfolded('unfolded', fm, stripContent);

      var historyBox = document.getElementById('history');
      if (historyBox !== null) {
        var history = fm.getFlexHistory().join(' ');
        historyBox.value = history;
      }

      var scriptDiv = document.getElementById('script');
      if (scriptDiv !== null) {
        scriptDiv.innerHTML = "";
      }
    }

    function newFlexagons(value) {
      var leaftree = null;
      var props = undefined;
      switch (value) {
        case "4": leaftree = [1, 2, 3, 4]; break;
        case "5": leaftree = [1, 2, 3, 4, 5]; break;
        case "6": leaftree = [1, 2, 3, 4, 5, 6]; break;
        case "6,6": leaftree = Flexagonator.hexaHexaLeafTree; props = Flexagonator.hexaHexaProperties; break;
        case "7": leaftree = [1, 2, 3, 4, 5, 6, 7]; break;
        case "8": leaftree = [1, 2, 3, 4, 5, 6, 7, 8]; break;
        case "9": leaftree = [1, 2, 3, 4, 5, 6, 7, 8, 9]; break;
        case "10": leaftree = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]; break;
        case "12": leaftree = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]; break;
      }

      if (leaftree != null) {
        var flexagon = Flexagonator.makeFlexagon(leaftree);
        fm = Flexagonator.makeFlexagonManager(flexagon, props);
        updateUI();

        var angleBox = document.getElementById('setAngle');
        if (angleBox !== null) {
          angleBox.value = "iso";
        }
      }
    }

    function setFace(label, onlyUnset) {
      var color;
      switch (label) {
        case "1": color = 0x0000ff; break;
        case "2": color = 0x00ff00; break;
        case "3": color = 0xff0000; break;
        case "4": color = 0x00ffff; break;
        case "5": color = 0xffff00; break;
        case "6": color = 0xff00ff; break;
        case "7": color = 0xdddddd; break;
        case "8": color = 0x999999; break;
      }
      if (label !== "") {
        if (onlyUnset) {
          fm.setUnsetFaceLabel(label, true);
          fm.setUnsetFaceColor(color, true);
        } else {
          fm.setFaceLabel(label, true);
          fm.setFaceColor(color, true);
        }
        updateUI();
      }
    }

    function setAngle(value) {
      var angles = null;
      switch (value) {
        case "iso":
          break;
        case "60-60-60":
          angles = [60, 60];
          break;
        case "60-30-90":
          angles = [60, 30];
          break;
        case "45-45-90":
          angles = [45, 45];
          break;
        case "45-30-105":
          angles = [45, 30];
          break;
        case "36-54-90":
          angles = [36, 54];
          break;
        case "30-60-90":
          angles = [30, 60];
          break;
      }
      if (angles === null) {
        fm.setIsosceles();
      } else {
        fm.setAngles(angles[0], angles[1]);
      }
      updateUI();
    }

    function flexAndShow(flex) {
      var result = fm.applyFlex(flex);
      if (result === true) {
        updateUI();
      } else {
        console.log(result);
      }
    }

    function applySequence(key, sequence) {
      if (key == 13) {
        if (sequence[0] === '[') {
          // if string starts with '[', assume it's a script to run
          var result = Flexagonator.RunScriptString(fm, sequence);
          if (Flexagonator.isFlexError(result) || Flexagonator.isTreeError(result)) {
            console.log(result);
          } else {
            fm = result;
            updateUI();
          }
        } else {
          // else assume it's a sequence of flexes
          var result = fm.applyFlexes(sequence);
          if (result === true) {
            updateUI();
          } else {
            console.log(result);
          }
        }
      }
    }

    function reset() {
      fm.undoAll();
      updateUI();
    }

    function undo() {
      fm.undo();
      updateUI();
    }

    function redo() {
      fm.redo();
      updateUI();
    }

    function seeScript() {
      var scriptDiv = document.getElementById('script');
      if (scriptDiv !== null) {
        var str = JSON.stringify(Flexagonator.MakeScript(fm));
        scriptDiv.innerHTML = str;
      }
    }
  </script>
</head>

<body>
  <h1>Flexagonator</h1>

  <p>
    base flexagon:
    <select onchange="newFlexagons(event.srcElement.value)">
      <option value="4">tetra</option>
      <option value="5">penta</option>
      <option value="6">hexa</option>
      <option value="6,6" selected>6-sided hexa</option>
      <option value="7">hepta</option>
      <option value="8">octa</option>
      <option value="9">ennea</option>
      <option value="10">deca</option>
      <option value="12">dodeca</option>
    </select> &nbsp;&nbsp;&nbsp; angles:
    <select onchange="setAngle(event.srcElement.value)" id="setAngle">
      <option value="iso" selected>isosceles</option>
      <option value="60-60-60">60-60-60</option>
      <option value="60-30-90">6: 60-30-90</option>
      <option value="45-45-90">8: 45-45-90</option>
      <option value="45-30-105">8: 45-30-105</option>
      <option value="36-54-90">10: 36-54-90</option>
      <option value="30-60-90">12: 30-60-90</option>
    </select> &nbsp;&nbsp;&nbsp; set face:
    <select onchange="setFace(event.srcElement.value, false)">
      <option value="" selected></option>
      <option value="1">1: blue</option>
      <option value="2">2: green</option>
      <option value="3">3: red</option>
      <option value="4">4: cyan</option>
      <option value="5">5: yellow</option>
      <option value="6">6: magenta</option>
      <option value="7">7: light grey</option>
      <option value="8">8: dark grey</option>
    </select> &nbsp;&nbsp;&nbsp; change unset leaves:
    <select onchange="setFace(event.srcElement.value, true)">
      <option value="" selected></option>
      <option value="1">1: blue</option>
      <option value="2">2: green</option>
      <option value="3">3: red</option>
      <option value="4">4: cyan</option>
      <option value="5">5: yellow</option>
      <option value="6">6: magenta</option>
      <option value="7">7: light grey</option>
      <option value="8">8: dark grey</option>
    </select>
  </p>

  <p>
    flex:
    <input onclick="flexAndShow('>');" type="button" value=">" />
    <input onclick="flexAndShow('<');" type="button" value="<" />
    <input onclick="flexAndShow('^');" type="button" value="^" />
    <input onclick="flexAndShow('P');" type="button" value="P" />
    <input onclick="flexAndShow('P\'');" type="button" value="P'" />
    <input onclick="flexAndShow('T');" type="button" value="T" />
    <input onclick="flexAndShow('T\'');" type="button" value="T'" />
    <input onclick="flexAndShow('S');" type="button" value="S" />
    <input onclick="flexAndShow('S\'');" type="button" value="S'" />
    <input onclick="flexAndShow('V');" type="button" value="V" />
    <input onclick="flexAndShow('V\'');" type="button" value="V'" />
    <input onclick="flexAndShow('F');" type="button" value="F" />
    <input onclick="flexAndShow('F\'');" type="button" value="F'" />
    <input onclick="flexAndShow('Lt');" type="button" value="Lt" />
    <input onclick="flexAndShow('Lt\'');" type="button" value="Lt'" />
    <input onclick="flexAndShow('Ltb');" type="button" value="Ltb" />
    <input onclick="flexAndShow('Ltb\'');" type="button" value="Ltb'" />
  </p>

  <p>
    generate:
    <input onclick="flexAndShow('P*');" type="button" value="P*" />
    <input onclick="flexAndShow('P\'*');" type="button" value="P'*" />
    <input onclick="flexAndShow('T*');" type="button" value="T*" />
    <input onclick="flexAndShow('T\'*');" type="button" value="T'*" />
    <input onclick="flexAndShow('S*');" type="button" value="S*" />
    <input onclick="flexAndShow('S\'*');" type="button" value="S'*" />
    <input onclick="flexAndShow('V*');" type="button" value="V*" />
    <input onclick="flexAndShow('V\'*');" type="button" value="V'*" />
    <input onclick="flexAndShow('F*');" type="button" value="F*" />
    <input onclick="flexAndShow('F\'*');" type="button" value="F'*" />
    <input onclick="flexAndShow('Lt*');" type="button" value="Lt*" />
    <input onclick="flexAndShow('Lt\'*');" type="button" value="Lt'*" />
    <input onclick="flexAndShow('Ltb*');" type="button" value="Ltb*" />
    <input onclick="flexAndShow('Ltb\'*');" type="button" value="Ltb'*" />
    <input onclick="flexAndShow('T1*');" type="button" value="T1*" />
    <input onclick="flexAndShow('T2*');" type="button" value="T2*" />
    <input onclick="flexAndShow('T3*');" type="button" value="T3*" />
  </p>
  <p>
    <div>
      <label>enter flex sequence</label>
      <input onkeypress="applySequence(event.charCode, event.srcElement.value)" id="enterFlexes" size="75" />
    </div>
  </p>
  <p>
    <input onclick="reset();" type="button" value="reset" />
    <input onclick="undo();" type="button" value="undo" />
    <input onclick="redo();" type="button" value="redo" />
    <textarea id="history" readonly=true cols="70" rows="1"></textarea>
  </p>

  <canvas id="interface" width="800" height="400"></canvas>
  <br/>
  <canvas id="unfolded" width="800" height="600"></canvas>

  <p>
    <input onclick="stripContent = 0; updateUI();" type="button" value="show folding numbers" />
    <input onclick="stripContent = 1; updateUI();" type="button" value="folding numbers + ids" />
    <input onclick="stripContent = 2; updateUI();" type="button" value="front colors and labels" />
    <input onclick="stripContent = 3; updateUI();" type="button" value="back colors and labels" />
  </p>

  <p>
    <input onclick="seeScript();" type="button" value="see script" />
    <div id="script"></div>
  </p>

  <script type="text/javascript">
    updateUI();
  </script>

</body>

</html>
