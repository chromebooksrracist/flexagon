<meta charset="UTF-8">
<html>

<head>
  <title>slot flexes</title>

  <style>
    body {
      font-family: Tahoma, Geneva, sans-serif;
    }

  </style>

  <script src="../build/out.js"></script>
  <script type="text/javascript">
    var defaultNumPats = 8;
    var defaultAngles = [45, 90];
    function switchFlexagon(value) {
      if (value === "6") {
        defaultNumPats = 6;
        defaultAngles = [60, 60];
      } else if (value === "7") {
        defaultNumPats = 7;
        defaultAngles = [51.4286, 64.2857];
      } else {
        defaultNumPats = 8;
        defaultAngles = [45, 90];
      }
      drawAll();
    }

    // draw a template that uses (pre* Lkk* post'*) as its generating sequence
    function drawTemplate(canvasId, pre, post, onlyHexa) {
      const numPats = onlyHexa ? 6 : defaultNumPats;
      const angles = onlyHexa ? [60, 60] : defaultAngles;
      // shift a few hinges so the tape isn't in the middle of the flex
      const flexes = getGenerator(pre, post) + (numPats === 8 ? ">>>>" : ">>>");
      const fm = Flexagonator.createFromScript([
        { numPats, angles, "addHalfFlexes": true },
        { flexes }
      ]);
      const captions = [{ text: pre + " Lkk", which: 0 }, { text: post + "'", which: -1 }];
      Flexagonator.drawUnfolded(canvasId, fm, { captions });

      const text = pre + " Lkk " + post + "' ";
      const ctx = document.getElementById(canvasId).getContext("2d");
      ctx.font = "15px sans-serif";
      ctx.fillText(text, 2, 16);

      const isEqualTo = decompose(pre, post, fm);
      ctx.fillText(isEqualTo, 2, 32);
      ctx.fillText(fm.flexagon.getLeafCount(), 2, 48);
    }

    // e.g. Hf* Lkk* Hb'+ Lkk' Hf'
    function getGenerator(pre, post) {
      const plus = post.startsWith(">>>") ? post + "'+<<<" : post + "'+";
      return pre + "* Lkk* " + plus + " Lkk' " + pre + "'";
    }

    // ehck if (pre Lkk post') can be decomposed into other flexes or if it's prime
    function decompose(pre, post, fm) {
      const sequence = pre + " Lkk " + post + "'";
      const newFlex = Flexagonator.makeFlexFromSequence(sequence, fm.allFlexes);
      const primes = getPrimesPlus(fm.allFlexes);
      const result = Flexagonator.findEqualFlexes(newFlex, primes);
      return simplify(result, fm.flexagon.getPatCount());
    }

    // all primes, but not Tf, plus >^
    function getPrimesPlus(allFlexes) {
      const primes = Flexagonator.getPrimeFlexes(allFlexes);
      const allNames = Object.getOwnPropertyNames(primes).filter(name => name !== 'Tf');
      const plus = {};
      allNames.forEach(name => plus[name] = primes[name]);
      plus[">"] = allFlexes[">"];
      plus["<"] = allFlexes["<"];
      plus["^"] = allFlexes["^"];
      return plus;
    }

    function simplify(s, numPats) {
      if (numPats === 6) {
        const a = s.replace(">>>>>", "<");
        return a.replace(">>>>", "<<");
      } else if (numPats === 7) {
        return s.replace(">>>>>>", "<");
      } else if (numPats === 8) {
        return s.replace(">>>>>>>", "<");
      }
      return s;
    }

    function drawAll() {
      drawTemplate("slot01", "Hf", "Hf");
      drawTemplate("slot02", "Hf", "Hb");
      drawTemplate("slot03", "Hf", "Hr");
      drawTemplate("slot04", "Hf", "Hl");
      drawTemplate("slot05", "Hf", "Hsr");
      drawTemplate("slot06", "Hf", "Hsl");
      drawTemplate("slot07", "Hb", "Hf");
      drawTemplate("slot08", "Hb", "Hb");
      drawTemplate("slot09", "Hb", "Hr");
      drawTemplate("slot10", "Hb", "Hl");
      drawTemplate("slot11", "Hb", "Hsr");
      drawTemplate("slot12", "Hb", "Hsl");
      drawTemplate("slot13", "Hr", "Hf");
      drawTemplate("slot14", "Hr", "Hb");
      drawTemplate("slot15", "Hr", "Hr");
      drawTemplate("slot16", "Hr", "Hl");
      drawTemplate("slot17", "Hr", "Hsr");
      drawTemplate("slot18", "Hr", "Hsl");
      drawTemplate("slot19", "Hl", "Hf");
      drawTemplate("slot20", "Hl", "Hb");
      drawTemplate("slot21", "Hl", "Hr");
      drawTemplate("slot22", "Hl", "Hl");
      drawTemplate("slot23", "Hl", "Hsr");
      drawTemplate("slot24", "Hl", "Hsl");
      drawTemplate("slot25", "Hsr", "Hf");
      drawTemplate("slot26", "Hsr", "Hb");
      drawTemplate("slot27", "Hsr", "Hr");
      drawTemplate("slot28", "Hsr", "Hl");
      drawTemplate("slot29", "Hsr", "Hsr");
      drawTemplate("slot30", "Hsr", "Hsl");
      drawTemplate("slot31", "Hsl", "Hf");
      drawTemplate("slot32", "Hsl", "Hb");
      drawTemplate("slot33", "Hsl", "Hr");
      drawTemplate("slot34", "Hsl", "Hl");
      drawTemplate("slot35", "Hsl", "Hsr");
      drawTemplate("slot36", "Hsl", "Hsl");
      drawTemplate("slot37", "Hf", "Hh", true);
      drawTemplate("slot38", "Hf", "Ht", true);
      drawTemplate("slot39", "Hf", ">>>Ht", true);
      drawTemplate("slot40", "Hf", ">>>Hf", true);
      drawTemplate("slot41", "Hb", "Hh", true);
      drawTemplate("slot42", "Hb", "Ht", true);
      drawTemplate("slot43", "Hb", ">>>Ht", true);
      drawTemplate("slot44", "Hb", ">>>Hf", true);
      drawTemplate("slot45", "Hr", "Hh", true);
      drawTemplate("slot46", "Hr", "Ht", true);
      drawTemplate("slot47", "Hr", ">>>Ht", true);
      drawTemplate("slot48", "Hr", ">>>Hf", true);
      drawTemplate("slot49", "Hl", "Hh", true);
      drawTemplate("slot50", "Hl", "Ht", true);
      drawTemplate("slot51", "Hl", ">>>Ht", true);
      drawTemplate("slot52", "Hl", ">>>Hf", true);
      drawTemplate("slot53", "Hsr", "Hh", true);
      drawTemplate("slot54", "Hsr", "Ht", true);
      drawTemplate("slot55", "Hsr", ">>>Ht", true);
      drawTemplate("slot56", "Hsr", ">>>Hf", true);
      drawTemplate("slot57", "Hsl", "Hh", true);
      drawTemplate("slot58", "Hsl", "Ht", true);
      drawTemplate("slot59", "Hsl", ">>>Ht", true);
      drawTemplate("slot60", "Hsl", ">>>Hf", true);
    }
  </script>
</head>

<body>
  <h1>Slot flexes</h1>

  <p>
    The following provides templates for a wide variety of slot flexes.
    They are generated by doing a half flex, the kite-to-kite slot (Lkk), followed by the inverse of a half flex.
    Each template lists the generating sequence, a decomposition in terms of prime flexes, and the number of leaves in
    the template.
    Note that some may require severe bending on the hexa or heptaflexagons, but not on the silver octaflexagon.
  </p>

  <ul>
    <li>sequence starts with <a href="#Hf">Hf</a>, <a href="#Hb">Hb</a>, <a href="#Hr">Hr</a>, <a href="#Hl">Hl</a>,
      <a href="#Hsr">Hsr</a>, <a href="#Hsl">Hsl</a>
    </li>
    <li>templates for generating sequences that only work on a <a href="#hexa">hexaflexagon</a></li>
  </ul>

  <p>
    pick flexagon:&nbsp;
    <select onchange="switchFlexagon(event.target.value)">
    <option value="6">regular hexaflexagon</option>
    <option value="7">regular heptaflexagon</option>
    <option value="8" selected>silver octaflexagon</option>
  </select>
  </p>

  <a id="Hf"></a>
  <canvas id="slot01" width="900" height="500"></canvas><br/>
  <canvas id="slot02" width="900" height="500"></canvas><br/>
  <canvas id="slot03" width="900" height="500"></canvas><br/>
  <canvas id="slot04" width="900" height="500"></canvas><br/>
  <canvas id="slot05" width="900" height="500"></canvas><br/>
  <canvas id="slot06" width="900" height="500"></canvas><br/>
  <a id="Hb"></a>
  <canvas id="slot07" width="900" height="500"></canvas><br/>
  <canvas id="slot08" width="900" height="500"></canvas><br/>
  <canvas id="slot09" width="900" height="500"></canvas><br/>
  <canvas id="slot10" width="900" height="500"></canvas><br/>
  <canvas id="slot11" width="900" height="500"></canvas><br/>
  <canvas id="slot12" width="900" height="500"></canvas><br/>
  <a id="Hr"></a>
  <canvas id="slot13" width="900" height="500"></canvas><br/>
  <canvas id="slot14" width="900" height="500"></canvas><br/>
  <canvas id="slot15" width="900" height="500"></canvas><br/>
  <canvas id="slot16" width="900" height="500"></canvas><br/>
  <canvas id="slot17" width="900" height="500"></canvas><br/>
  <canvas id="slot18" width="900" height="500"></canvas><br/>
  <a id="Hl"></a>
  <canvas id="slot19" width="900" height="500"></canvas><br/>
  <canvas id="slot20" width="900" height="500"></canvas><br/>
  <canvas id="slot21" width="900" height="500"></canvas><br/>
  <canvas id="slot22" width="900" height="500"></canvas><br/>
  <canvas id="slot23" width="900" height="500"></canvas><br/>
  <canvas id="slot24" width="900" height="500"></canvas><br/>
  <a id="Hsr"></a>
  <canvas id="slot25" width="900" height="500"></canvas><br/>
  <canvas id="slot26" width="900" height="500"></canvas><br/>
  <canvas id="slot27" width="900" height="500"></canvas><br/>
  <canvas id="slot28" width="900" height="500"></canvas><br/>
  <canvas id="slot29" width="900" height="500"></canvas><br/>
  <canvas id="slot30" width="900" height="500"></canvas><br/>
  <a id="Hsl"></a>
  <canvas id="slot31" width="900" height="500"></canvas><br/>
  <canvas id="slot32" width="900" height="500"></canvas><br/>
  <canvas id="slot33" width="900" height="500"></canvas><br/>
  <canvas id="slot34" width="900" height="500"></canvas><br/>
  <canvas id="slot35" width="900" height="500"></canvas><br/>
  <canvas id="slot36" width="900" height="500"></canvas><br/>

  <hr />
  <h2 id="hexa">hexaflexagon only</h2>
  <canvas id="slot37" width="900" height="500"></canvas><br/>
  <canvas id="slot38" width="900" height="500"></canvas><br/>
  <canvas id="slot39" width="900" height="500"></canvas><br/>
  <canvas id="slot40" width="900" height="500"></canvas><br/>
  <canvas id="slot41" width="900" height="500"></canvas><br/>
  <canvas id="slot42" width="900" height="500"></canvas><br/>
  <canvas id="slot43" width="900" height="500"></canvas><br/>
  <canvas id="slot44" width="900" height="500"></canvas><br/>
  <canvas id="slot45" width="900" height="500"></canvas><br/>
  <canvas id="slot46" width="900" height="500"></canvas><br/>
  <canvas id="slot47" width="900" height="500"></canvas><br/>
  <canvas id="slot48" width="900" height="500"></canvas><br/>
  <canvas id="slot49" width="900" height="500"></canvas><br/>
  <canvas id="slot50" width="900" height="500"></canvas><br/>
  <canvas id="slot51" width="900" height="500"></canvas><br/>
  <canvas id="slot52" width="900" height="500"></canvas><br/>
  <canvas id="slot53" width="900" height="500"></canvas><br/>
  <canvas id="slot54" width="900" height="500"></canvas><br/>
  <canvas id="slot55" width="900" height="500"></canvas><br/>
  <canvas id="slot56" width="900" height="500"></canvas><br/>
  <canvas id="slot57" width="900" height="500"></canvas><br/>
  <canvas id="slot58" width="900" height="500"></canvas><br/>
  <canvas id="slot59" width="900" height="500"></canvas><br/>
  <canvas id="slot60" width="900" height="500"></canvas><br/>

  <script type="text/javascript">
    drawAll();
  </script>
</body>

</html>
