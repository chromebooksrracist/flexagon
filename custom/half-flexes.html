<meta charset="UTF-8">
<html>

<head>
  <title>combining half flexes</title>

  <style>
    body {
      font-family: Tahoma, Geneva, sans-serif;
    }

  </style>

  <script src="../build/out.js"></script>
  <script type="text/javascript">
    var defaultNumPats = 8;
    var defaultAngles = [45, 90];
    function switchFlexagon(value) {
      if (value === "6") {
        defaultNumPats = 6;
        defaultAngles = [60, 60];
      } else if (value === "7") {
        defaultNumPats = 7;
        defaultAngles = [51.4286, 64.2857];
      } else {
        defaultNumPats = 8;
        defaultAngles = [45, 90];
      }
      drawAll();
    }

    // draw a template that uses (pre* Lkk* post'*) as its generating sequence
    function drawTemplate(canvasId, pre, post, onlyHexa) {
      const numPats = onlyHexa ? 6 : defaultNumPats;
      const angles = onlyHexa ? [60, 60] : defaultAngles;
      // shift a few hinges so the tape isn't in the middle of the flex
      const flexes = getGenerator(pre, post) + (numPats === 8 ? ">>>>" : ">>>");
      const fm = Flexagonator.createFromScript([
        { numPats, angles, "addHalfFlexes": true },
        { flexes }
      ]);
      const captions = [{ text: pre + " Lkk", which: 0 }, { text: post + "'", which: -1 }];
      Flexagonator.drawUnfolded(canvasId, fm, { captions });

      const text = pre + " Lkk " + post + "' ";
      const ctx = document.getElementById(canvasId).getContext("2d");
      ctx.font = "15px sans-serif";
      ctx.fillText(text, 2, 16);

      const isEqualTo = decompose(pre, post, fm);
      ctx.fillText(isEqualTo, 2, 32);
      ctx.fillText(fm.flexagon.getLeafCount(), 2, 48);
    }

    // e.g. Hf* Lkk* Hb'+ Lkk' Hf'
    function getGenerator(pre, post) {
      const plus = post.startsWith(">>>") ? post + "'+<<<" : post + "'+";
      return pre + "* Lkk* " + plus + " Lkk' " + pre + "'";
    }

    // ehck if (pre Lkk post') can be decomposed into other flexes or if it's prime
    function decompose(pre, post, fm) {
      const sequence = pre + " Lkk " + post + "'";
      const newFlex = Flexagonator.makeFlexFromSequence(sequence, fm.allFlexes);
      const primes = getPrimesPlus(fm.allFlexes);
      const result = Flexagonator.findEqualFlexes(newFlex, primes);
      return simplify(result, fm.flexagon.getPatCount());
    }

    // all primes, but not Tf, plus >^
    function getPrimesPlus(allFlexes) {
      const primes = Flexagonator.getPrimeFlexes(allFlexes);
      const allNames = Object.getOwnPropertyNames(primes).filter(name => name !== 'Tf');
      const plus = {};
      allNames.forEach(name => plus[name] = primes[name]);
      plus[">"] = allFlexes[">"];
      plus["<"] = allFlexes["<"];
      plus["^"] = allFlexes["^"];
      return plus;
    }

    function simplify(s, numPats) {
      if (numPats === 6) {
        const a = s.replace(">>>>>", "<");
        return a.replace(">>>>", "<<");
      } else if (numPats === 7) {
        return s.replace(">>>>>>", "<");
      } else if (numPats === 8) {
        return s.replace(">>>>>>>", "<");
      }
      return s;
    }

    function drawAll() {
      const halves = ["Hf", "Hb", "Hr", "Hl", "Hsr", "Hsl"];
      const hexaHalves = ["Hh", "Ht", ">>>Ht", ">>>Hf"];

      let i = 1;
      halves.forEach(a => {
        halves.forEach(b => {
          const canvas = "slot" + i.toString();
          drawTemplate(canvas, a, b);
          i++;
        });
      });
      halves.forEach(a => {
        hexaHalves.forEach(b => {
          const canvas = "slot" + i.toString();
          drawTemplate(canvas, a, b, true);
          i++;
        });
      });
    }
  </script>
</head>

<body>
  <h1>Combining half flexes</h1>

  <p>
    This page describes a wide variety of flexes composed of "half flexes", including a decomposition into prime flexes
    and templates.
    They are generated by doing a half flex, an optional kite-to-kite slot (Lkk), followed by the inverse of a half
    flex.
    Each template lists the generating sequence, a decomposition in terms of prime flexes, and the number of leaves in
    the template.
    Note that some may require severe bending on the hexa or heptaflexagons, but not on the silver octaflexagon.
  </p>

  <p>
    The half flexes that work on a wide variety of isoflexagons are the front <i>Hf</i>, back <i>Hb</i>, right
    <i>Hr</i>,
    left <i>Hl</i>, shuffle right <i>Hsr</i>, and shuffle left <i>Hsl</i>.
    The half flexes that are just defined for the hexaflexagon are the half half <i>Hh</i> and half tuck <i>Ht</i>.
    Definitions for all these half flexes can be found on the <a href="atomic.html">atomic flexes</a> page.
  </p>

  <p>Decomposition of slot flexes into flexes that are prime on a hexaflexagon.</p>
  <pre>
Ltf            = Hf Lkk Hf'     = Hsl Lkk Hsl'    = &lt; Hb Lkk Hb'   = &lt; Hsr Lkk Hsr'
&gt;Ltf ^&gt;T'      = Hb Lkk Hl'     = Hsr Lkk Hr'
&gt;Ltf ^S        = Hb Lkk Hsr'    = &lt; Hsl Lkk Hf'
&gt;Ltf ^S &gt;T'    = Hb Lkk Hr'
&gt;Ltf ^F        = Hb Lkk Hf'
&gt;Ltf &gt;F &gt;Ltf   = Hb Lkk Hsl'    = Hsr Lkk Hf'
^&gt;&gt;T' ^&gt;&gt;T     = Hf Lkk Hb'
&gt;T &lt;Ltf        = Hr Lkk Hf'     = Hl Lkk Hsl'
&gt;T &lt;Ltf ^S     = Hl Lkk Hf'
&gt;T &lt;S Ltf      = Hr Lkk Hsl'
&gt;T ^&gt;&gt;S F      = Hl Lkk Hsr'
&gt;T ^&gt;&gt;S F &gt;&gt;T' = Hl Lkk Hr'
&gt;T &lt;S ^&gt;F &gt;&gt;T' = Hr Lkk Hl'
&gt;T ^&gt;&gt;F        = Hr Lkk Hsr'    = Hl Lkk Hb'
&gt;T ^&gt;&gt;F &gt;&gt;T'   = Hr Lkk Hr'     = Hl Lkk Hl'
&gt;T ^&gt;&gt;F ^S     = Hr Lkk Hb'
^&gt;F &gt;&gt;T'       = Hf Lkk Hr'     = Hsl Lkk Hl'
S Ltf          = Hf Lkk Hsl'    = &lt; Hsr Lkk Hb'
&gt;S Ltf ^&gt;T'    = Hsr Lkk Hl'
&gt;S Ltf &gt;F &gt;Ltf = Hsr Lkk Hsl'
^&gt;S F          = Hsl Lkk Hsr'
S ^&gt;F &gt;&gt;T'     = Hf Lkk Hl'
^&gt;S F &gt;&gt;T'     = Hsl Lkk Hr'
^&gt;F            = Hf Lkk Hsr'    = Hsl Lkk Hb'
</pre>

  <p>This list is for slots specific to a hexaflexagon.</p>
  <pre>
Ltb            = Hf Lkk Ht'     = Hsl Lkk Hh'     = &lt; Hb Lkk &gt;&gt;&gt;Hf'
Ltb T          = Hsl Lkk Ht'
Ltb T'         = Hf Lkk Hh'     = &lt; Hsr Lkk &gt;&gt;&gt;Hf'
&lt;V             = Hf Lkk &gt;&gt;&gt;Hf'
&lt;V ^P          = Hf Lkk &gt;&gt;&gt;Ht'
&lt;V T           = Hsl Lkk &gt;&gt;&gt;Hf'
&lt;V ^&gt;&gt;&gt;V       = Hsl Lkk &gt;&gt;&gt;Ht'
&gt;Ltf V         = Hb Lkk Hh'     = Hsr Lkk Ht'
&gt;Ltf &gt;P        = Hb Lkk &gt;&gt;&gt;Ht'
&gt;T &lt;Ltb        = Hr Lkk Ht'     = Hl Lkk Hh'
&gt;T &lt;Ltb T      = Hl Lkk Ht'
&gt;T &lt;Ltb T'     = Hr Lkk Hh'
&gt;T &lt;&lt;V         = Hr Lkk &gt;&gt;&gt;Hf'
&gt;T &lt;&lt;V ^P      = Hr Lkk &gt;&gt;&gt;Ht'
&gt;T &lt;&lt;V T       = Hl Lkk &gt;&gt;&gt;Hf'
&gt;T &lt;&lt;V ^&gt;&gt;&gt;V   = Hl Lkk &gt;&gt;&gt;Ht'
&gt;S Ltf V       = Hsr Lkk Hh'
&gt;S Ltf &gt;P      = Hsr Lkk &gt;&gt;>Ht'
^F ^Ltb        = Hb Lkk Ht'
</pre>

  <h2>Templates</h2>

  <p>
    pick flexagon:&nbsp;
    <select onchange="switchFlexagon(event.target.value)">
    <option value="6">regular hexaflexagon</option>
    <option value="7">regular heptaflexagon</option>
    <option value="8" selected>silver octaflexagon</option>
  </select>
  </p>

  <ul>
    <li>sequence starts with <a href="#Hf">Hf</a>, <a href="#Hb">Hb</a>, <a href="#Hr">Hr</a>, <a href="#Hl">Hl</a>,
      <a href="#Hsr">Hsr</a>, <a href="#Hsl">Hsl</a>
    </li>
    <li>templates for generating sequences that only work on a <a href="#hexa">hexaflexagon</a></li>
  </ul>

  <a id="Hf"></a>
  <canvas id="slot1" width="900" height="500"></canvas><br/>
  <canvas id="slot2" width="900" height="500"></canvas><br/>
  <canvas id="slot3" width="900" height="500"></canvas><br/>
  <canvas id="slot4" width="900" height="500"></canvas><br/>
  <canvas id="slot5" width="900" height="500"></canvas><br/>
  <canvas id="slot6" width="900" height="500"></canvas><br/>
  <a id="Hb"></a>
  <canvas id="slot7" width="900" height="500"></canvas><br/>
  <canvas id="slot8" width="900" height="500"></canvas><br/>
  <canvas id="slot9" width="900" height="500"></canvas><br/>
  <canvas id="slot10" width="900" height="500"></canvas><br/>
  <canvas id="slot11" width="900" height="500"></canvas><br/>
  <canvas id="slot12" width="900" height="500"></canvas><br/>
  <a id="Hr"></a>
  <canvas id="slot13" width="900" height="500"></canvas><br/>
  <canvas id="slot14" width="900" height="500"></canvas><br/>
  <canvas id="slot15" width="900" height="500"></canvas><br/>
  <canvas id="slot16" width="900" height="500"></canvas><br/>
  <canvas id="slot17" width="900" height="500"></canvas><br/>
  <canvas id="slot18" width="900" height="500"></canvas><br/>
  <a id="Hl"></a>
  <canvas id="slot19" width="900" height="500"></canvas><br/>
  <canvas id="slot20" width="900" height="500"></canvas><br/>
  <canvas id="slot21" width="900" height="500"></canvas><br/>
  <canvas id="slot22" width="900" height="500"></canvas><br/>
  <canvas id="slot23" width="900" height="500"></canvas><br/>
  <canvas id="slot24" width="900" height="500"></canvas><br/>
  <a id="Hsr"></a>
  <canvas id="slot25" width="900" height="500"></canvas><br/>
  <canvas id="slot26" width="900" height="500"></canvas><br/>
  <canvas id="slot27" width="900" height="500"></canvas><br/>
  <canvas id="slot28" width="900" height="500"></canvas><br/>
  <canvas id="slot29" width="900" height="500"></canvas><br/>
  <canvas id="slot30" width="900" height="500"></canvas><br/>
  <a id="Hsl"></a>
  <canvas id="slot31" width="900" height="500"></canvas><br/>
  <canvas id="slot32" width="900" height="500"></canvas><br/>
  <canvas id="slot33" width="900" height="500"></canvas><br/>
  <canvas id="slot34" width="900" height="500"></canvas><br/>
  <canvas id="slot35" width="900" height="500"></canvas><br/>
  <canvas id="slot36" width="900" height="500"></canvas><br/>

  <hr />
  <h2 id="hexa">hexaflexagon only</h2>
  <canvas id="slot37" width="900" height="500"></canvas><br/>
  <canvas id="slot38" width="900" height="500"></canvas><br/>
  <canvas id="slot39" width="900" height="500"></canvas><br/>
  <canvas id="slot40" width="900" height="500"></canvas><br/>
  <canvas id="slot41" width="900" height="500"></canvas><br/>
  <canvas id="slot42" width="900" height="500"></canvas><br/>
  <canvas id="slot43" width="900" height="500"></canvas><br/>
  <canvas id="slot44" width="900" height="500"></canvas><br/>
  <canvas id="slot45" width="900" height="500"></canvas><br/>
  <canvas id="slot46" width="900" height="500"></canvas><br/>
  <canvas id="slot47" width="900" height="500"></canvas><br/>
  <canvas id="slot48" width="900" height="500"></canvas><br/>
  <canvas id="slot49" width="900" height="500"></canvas><br/>
  <canvas id="slot50" width="900" height="500"></canvas><br/>
  <canvas id="slot51" width="900" height="500"></canvas><br/>
  <canvas id="slot52" width="900" height="500"></canvas><br/>
  <canvas id="slot53" width="900" height="500"></canvas><br/>
  <canvas id="slot54" width="900" height="500"></canvas><br/>
  <canvas id="slot55" width="900" height="500"></canvas><br/>
  <canvas id="slot56" width="900" height="500"></canvas><br/>
  <canvas id="slot57" width="900" height="500"></canvas><br/>
  <canvas id="slot58" width="900" height="500"></canvas><br/>
  <canvas id="slot59" width="900" height="500"></canvas><br/>
  <canvas id="slot60" width="900" height="500"></canvas><br/>

  <script type="text/javascript">
    drawAll();
  </script>
</body>

</html>
